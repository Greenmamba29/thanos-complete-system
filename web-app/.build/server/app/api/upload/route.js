"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5315:e=>{e.exports=require("path")},8502:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>g});var a={};i.r(a),i.d(a,{POST:()=>d});var r=i(9182),n=i(2007),o=i(6719),s=i(3442),p=i(3524),c=i(7639),l=i(4761);let u=new p.PrismaClient;async function d(e){try{let t=(await e.formData()).get("file");if(!t)return s.NextResponse.json({error:"No file provided"},{status:400});let i=(0,l.He)(t.name),a=`${Date.now()}_${i}`,r=await (0,c.Ho)(t,a),n=await (0,c.BR)(r);if(!n)return s.NextResponse.json({error:"Failed to get file stats"},{status:500});let o=await u.fileRecord.create({data:{originalName:t.name,currentName:a,originalPath:r,currentPath:r,fileType:n.type,fileSize:t.size,mimeType:t.type,category:(0,l.T2)(t.type),metadata:JSON.stringify({uploadedAt:new Date().toISOString(),originalSize:t.size,mimeType:t.type}),tags:JSON.stringify([])}});return s.NextResponse.json({success:!0,fileId:o.id,metadata:{name:t.name,originalName:t.name,path:r,size:t.size,type:n.type,mimeType:t.type,lastModified:new Date,category:(0,l.T2)(t.type)}})}catch(e){return console.error("File upload error:",e),s.NextResponse.json({error:"Failed to upload file"},{status:500})}finally{await u.$disconnect()}}let m=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/home/ubuntu/thanos_file_organizer/app/app/api/upload/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:w}=m,x="/api/upload/route";function y(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:g})}},7639:(e,t,i)=>{i.d(t,{BR:()=>m,f_:()=>u,Fk:()=>d,Ho:()=>l});let a=require("fs/promises");var r=i.n(a),n=i(5315),o=i.n(n);let s=o().join(process.cwd(),"uploads"),p=o().join(process.cwd(),"uploads","organized");async function c(){try{await r().mkdir(s,{recursive:!0}),await r().mkdir(p,{recursive:!0})}catch(e){console.error("Error creating directories:",e)}}async function l(e,t){await c();let i=Buffer.from(await e.arrayBuffer()),a=o().join(s,t);return await r().writeFile(a,i),a}async function u(e,t,i,a){let n=i?o().join(p,t,i):o().join(p,t);await r().mkdir(n,{recursive:!0});let s=o().join(n,a);return await r().copyFile(e,s),s}async function d(e,t){await r().copyFile(e,t)}async function m(e){try{let t=await r().stat(e),i=o().basename(e);return{name:i,originalName:i,path:e,size:t.size,type:o().extname(i).slice(1).toLowerCase(),mimeType:({".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".gif":"image/gif",".webp":"image/webp",".svg":"image/svg+xml",".pdf":"application/pdf",".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".txt":"text/plain",".csv":"text/csv",".mp4":"video/mp4",".mp3":"audio/mpeg",".wav":"audio/wav",".zip":"application/zip"})[o().extname(i).toLowerCase()]||"application/octet-stream",lastModified:t.mtime}}catch(e){return console.error("Error getting file stats:",e),null}}},4761:(e,t,i)=>{i.d(t,{He:()=>s,T2:()=>o,cn:()=>n});var a=i(1862),r=i(2703);function n(...e){return(0,r.m6)((0,a.W)(e))}function o(e){return e.startsWith("image/")?"Images":e.startsWith("video/")?"Videos":e.startsWith("audio/")?"Audio":e.includes("pdf")?"PDFs":e.includes("document")||e.includes("msword")||e.includes("wordprocessing")?"Documents":e.includes("sheet")||e.includes("excel")||e.includes("csv")?"Spreadsheets":e.includes("presentation")||e.includes("powerpoint")?"Presentations":e.includes("text")?"Text Files":e.includes("zip")||e.includes("rar")||e.includes("tar")||e.includes("gzip")?"Archives":"Other"}function s(e){return e.replace(/[^a-zA-Z0-9.-]/g,"_").replace(/_+/g,"_")}}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[412,609,255],()=>i(8502));module.exports=a})();