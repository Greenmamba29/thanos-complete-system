"use strict";(()=>{var e={};e.id=523,e.ids=[523],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5315:e=>{e.exports=require("path")},7677:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{POST:()=>l});var i=r(9182),n=r(2007),o=r(6719),s=r(3442),p=r(3524),u=r(7639);let c=new p.PrismaClient;async function l(e){try{let{organizationId:t}=await e.json();if(!t)return s.NextResponse.json({error:"Organization ID required"},{status:400});let r=await c.organization.findUnique({where:{id:t},include:{files:!0}});if(!r)return s.NextResponse.json({error:"Organization not found"},{status:404});if(r.isUndone)return s.NextResponse.json({error:"Organization already undone"},{status:400});for(let e of r.files)try{await (0,u.Fk)(e.currentPath,e.originalPath),await c.fileRecord.update({where:{id:e.id},data:{currentPath:e.originalPath,currentName:e.originalName,category:null,subcategory:null,tags:JSON.stringify([]),organizationId:null}})}catch(t){console.error(`Error restoring file ${e.originalName}:`,t)}return await c.organization.update({where:{id:t},data:{isUndone:!0,status:"undone"}}),s.NextResponse.json({success:!0,message:"Organization undone successfully"})}catch(e){return console.error("Undo error:",e),s.NextResponse.json({error:"Failed to undo organization"},{status:500})}finally{await c.$disconnect()}}let d=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/undo/route",pathname:"/api/undo",filename:"route",bundlePath:"app/api/undo/route"},resolvedPagePath:"/home/ubuntu/thanos_file_organizer/app/app/api/undo/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:f}=d,w="/api/undo/route";function x(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},7639:(e,t,r)=>{r.d(t,{BR:()=>m,f_:()=>l,Fk:()=>d,Ho:()=>c});let a=require("fs/promises");var i=r.n(a),n=r(5315),o=r.n(n);let s=o().join(process.cwd(),"uploads"),p=o().join(process.cwd(),"uploads","organized");async function u(){try{await i().mkdir(s,{recursive:!0}),await i().mkdir(p,{recursive:!0})}catch(e){console.error("Error creating directories:",e)}}async function c(e,t){await u();let r=Buffer.from(await e.arrayBuffer()),a=o().join(s,t);return await i().writeFile(a,r),a}async function l(e,t,r,a){let n=r?o().join(p,t,r):o().join(p,t);await i().mkdir(n,{recursive:!0});let s=o().join(n,a);return await i().copyFile(e,s),s}async function d(e,t){await i().copyFile(e,t)}async function m(e){try{let t=await i().stat(e),r=o().basename(e);return{name:r,originalName:r,path:e,size:t.size,type:o().extname(r).slice(1).toLowerCase(),mimeType:({".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".gif":"image/gif",".webp":"image/webp",".svg":"image/svg+xml",".pdf":"application/pdf",".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".txt":"text/plain",".csv":"text/csv",".mp4":"video/mp4",".mp3":"audio/mpeg",".wav":"audio/wav",".zip":"application/zip"})[o().extname(r).toLowerCase()]||"application/octet-stream",lastModified:t.mtime}}catch(e){return console.error("Error getting file stats:",e),null}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[412,609],()=>r(7677));module.exports=a})();